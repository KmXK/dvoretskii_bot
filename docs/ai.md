# –†–∞–±–æ—Ç–∞ —Å –ò–ò

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         Handler                                 ‚îÇ
‚îÇ  (ai_handler, pasha_handler, ...)                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ  register_ai_handler("name", ai_call)                           ‚îÇ
‚îÇ  execute_ai_request(context, text, ai_call, "name")             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ     ai_context.py       ‚îÇ
              ‚îÇ                         ‚îÇ
              ‚îÇ  build_reply_context()  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ Telethon: —Å–æ–±–∏—Ä–∞–µ—Ç
              ‚îÇ  execute_ai_request()   ‚îÇ     —Ü–µ–ø–æ—á–∫—É —Ä–µ–ø–ª–∞–µ–≤
              ‚îÇ  register/get_ai_handler‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
         ‚ñº                 ‚ñº                 ‚ñº
   AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (ai.py): Yandex, DeepSeek, OpenRouter
         ‚îÇ                 ‚îÇ                 ‚îÇ
         ‚ñº                 ‚ñº                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              AiRelatedMessageHandler                ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –õ–æ–≤–∏—Ç —Ä–µ–ø–ª–∞–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç         ‚îÇ
‚îÇ  –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –ø–æ –ø–æ–ª—é handler –≤ ai_messages,           ‚îÇ
‚îÇ  –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —á–µ—Ä–µ–∑ —Ç–æ—Ç –∂–µ AI                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã

–û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `steward/helpers/ai.py`. –ö–∞–∂–¥—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä ‚Äî —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `user_id`, `messages` –∏ `system_prompt`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫—É –æ—Ç–≤–µ—Ç–∞.

| –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –§—É–Ω–∫—Ü–∏—è | Async | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|---|---|---|---|
| **Yandex GPT** | `make_yandex_ai_query` | –¥–∞ | –°–∞–º—ã–π –¥–µ—à—ë–≤—ã–π, –∏—Å–ø–æ–ª—å–∑—É–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
| **OpenRouter** | `make_openrouter_query` | –¥–∞ | –õ—é–±—ã–µ –º–æ–¥–µ–ª–∏, —Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `DOWNLOAD_PROXY` |
| **DeepSeek** | `make_deepseek_query` | –Ω–µ—Ç | –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `text` –≤–º–µ—Å—Ç–æ `messages`, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–ø–ª–∞–µ–≤ |

–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏ env-–∫–ª—é—á–∏ ‚Äî —Å–º. –∫–ª–∞—Å—Å—ã `YandexModelTypes`, `OpenRouterModel` –≤ `ai.py`.

## –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π

Yandex –∏ OpenRouter –ø—Ä–∏–Ω–∏–º–∞—é—Ç `messages: list[tuple[str, str]]` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π `(role, text)`:

```python
messages = [
    ("user", "–ü—Ä–∏–≤–µ—Ç"),
    ("assistant", "–ó–¥–∞—Ä–æ–≤–∞"),
    ("user", "–ö–∞–∫ –¥–µ–ª–∞?"),
]
```

## –ü—Ä–æ–º–ø—Ç—ã

–õ–µ–∂–∞—Ç –≤ `prompts/*.txt`. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ `get_prompt()` –≤ `ai.py` –∫–∞–∫ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –º–æ–¥—É–ª—è.

–ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π: —Å–æ–∑–¥–∞–π —Ñ–∞–π–ª –≤ `prompts/` –∏ –¥–æ–±–∞–≤—å –≤ `ai.py`:

```python
MY_PROMPT = get_prompt("–∏–º—è_—Ñ–∞–π–ª–∞")
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è `/ai`

–î–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ `/ai` —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏:
- –±–µ—Ä—ë—Ç—Å—è —à–∞–±–ª–æ–Ω –∏–∑ `prompts/grok_short_aggressive.txt`
- –º–∞—Ä–∫–µ—Ä `{{USERS_DESCRIPTIONS}}` –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–ø–∏—Å–æ–∫ –∏–∑ `User.stand_name` + `User.stand_description`
- –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞

–í–∞–∂–Ω–æ: –≤ –ø—Ä–æ–º–ø—Ç —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—é—Ç—Å—è –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º —ç—Ç–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π:
- `/stands` ‚Äî —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `/stands add <–∏–º—è>` ‚Äî –∑–∞–ø—É—Å–∫ –ø–æ—à–∞–≥–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (–æ–ø–∏—Å–∞–Ω–∏–µ + –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
- `/stands remove <–∏–º—è>` ‚Äî —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–ø–ª–∞–µ–≤

`execute_ai_request` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –∏–∑ —Ü–µ–ø–æ—á–∫–∏ —Ä–µ–ø–ª–∞–µ–≤ –≤ —á–∞—Ç–µ.

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. `build_reply_context()` –±–µ—Ä—ë—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∏–¥—ë—Ç –ø–æ —Ü–µ–ø–æ—á–∫–µ `reply_to` —á–µ—Ä–µ–∑ Telethon
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å: –æ—Ç –±–æ—Ç–∞ ‚Äî `assistant`, –∏–Ω–∞—á–µ ‚Äî `user`
3. –ï—Å–ª–∏ –ø—Ä—è–º–æ–≥–æ —Ä–µ–ø–ª–∞—è –Ω–µ—Ç, –∏—â–µ—Ç —Å–≤—è–∑—å —á–µ—Ä–µ–∑ `db.ai_messages` (–º–∞–ø–ø–∏–Ω–≥ –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ ‚Üí –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
4. –°–æ–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ AI-–ø—Ä–æ–≤–∞–π–¥–µ—Ä

### –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

–ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞ –≤ `db.ai_messages` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `AiMessage` (`timestamp`, `message_id`, `handler`). –ú–∞–∫—Å–∏–º—É–º 1000 –∑–∞–ø–∏—Å–µ–π, —Å—Ç–∞—Ä—ã–µ –≤—ã—Ç–µ—Å–Ω—è—é—Ç—Å—è.

## –ö–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π AI-—Ö–µ–Ω–¥–ª–µ—Ä

1. –°–æ–∑–¥–∞–π –ø—Ä–æ–º–ø—Ç –≤ `prompts/`, –∑–∞–≥—Ä—É–∑–∏ –≤ `ai.py`
2. –í —Ö–µ–Ω–¥–ª–µ—Ä–µ –≤—ã–∑–æ–≤–∏ `register_ai_handler` —Å –∏–º–µ–Ω–µ–º –∏ callable ‚Äî —ç—Ç–æ –≤–∫–ª—é—á–∏—Ç –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ —á–µ—Ä–µ–∑ —Ä–µ–ø–ª–∞–∏
3. –í –º–µ—Ç–æ–¥–µ `chat` –≤—ã–∑–æ–≤–∏ `execute_ai_request` —Å –Ω—É–∂–Ω—ã–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º, –ø—Ä–æ–º–ø—Ç–æ–º –∏ —Ç–µ–º –∂–µ –∏–º–µ–Ω–µ–º
4. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π —Ö–µ–Ω–¥–ª–µ—Ä –≤ `main.py`

`execute_ai_request` –±–µ—Ä—ë—Ç –Ω–∞ —Å–µ–±—è: —Å–±–æ—Ä–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –≤—ã–∑–æ–≤ AI, –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç–≤–µ—Ç–∞, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î.

–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã: `ai_handler.py` (OpenRouter), `pasha_handler.py` (Yandex).

## AI Router (natural language ‚Üí –∫–æ–º–∞–Ω–¥–∞)

`AiRouterHandler` (`steward/handlers/ai_router_handler.py`) –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ.

### –¢—Ä–∏–≥–≥–µ—Ä—ã

–°–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –æ–¥–Ω–æ–≥–æ –∏–∑:
- `@bot_username`
- `–¥–≤–æ—Ä–µ—Ü–∫–∏–π`
- `—É–≤–∞–∂–∞–µ–º—ã–π`
- –æ—Ç–≤–µ—Ç (reply) –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞ –∏–ª–∏ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç–∞ ‚Äî —Ç—Ä–∏–≥–≥–µ—Ä-—Å–ª–æ–≤–æ –Ω–µ –Ω—É–∂–Ω–æ

### –ü—Ä–∏–º–µ—Ä—ã

–ü—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞:
```
—É–≤–∞–∂–∞–µ–º—ã–π, –Ω–∞–ø–æ–º–Ω–∏ —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç –ø–æ–∫–æ—Ä–º–∏—Ç—å –∫–æ—Ç–∞
‚Üí ü§ñ /remind 10m –ø–æ–∫–æ—Ä–º–∏—Ç—å –∫–æ—Ç–∞  [‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]
```

–ü–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ + —Ä–µ–ø–ª–∞–π:
```
[–ü–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ: "–í—Å—Ç—Ä–µ—á–∞ 25 —Ñ–µ–≤—Ä–∞–ª—è –≤ 10:00"]
‚Ü≥ –¥–≤–æ—Ä–µ—Ü–∫–∏–π, –Ω–∞–ø–æ–º–Ω–∏
‚Üí ü§ñ /remind 25.02 10:00 –í—Å—Ç—Ä–µ—á–∞  [‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]
```

–ë–∞–Ω –ø–æ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é:
```
[–ü–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ –æ—Ç @spammer: "–∫—É–ø–∏ –±–∏—Ç–∫–æ–∏–Ω"]
‚Ü≥ –¥–≤–æ—Ä–µ—Ü–∫–∏–π, –∑–∞–±–∞–Ω—å —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –Ω–∞ 5 –º–∏–Ω—É—Ç
‚Üí ü§ñ /ban @spammer 5m  [‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]
```

–ù–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥:
```
—É–≤–∞–∂–∞–µ–º—ã–π, –Ω–∞–ø–æ–º–Ω–∏ —á–µ—Ä–µ–∑ —á–∞—Å –∏ –¥–æ–±–∞–≤—å –≤ —Å–ø–∏—Å–æ–∫ –¥–µ–ª: –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ
‚Üí ü§ñ /remind 1h –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ
     /todo –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ
  [‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å] [‚ùå –û—Ç–º–µ–Ω–∞]
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –õ–æ–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞—á–∏–Ω–∞—é—â–∏–µ—Å—è —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞ –∏–ª–∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç–∞ (–Ω–µ –∫–æ–º–∞–Ω–¥—ã `/`)
2. –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî —Ä–µ–ø–ª–∞–π, —Ç–µ–∫—Å—Ç –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ `reply_to_message` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è LLM –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç (–≤–∫–ª—é—á–∞—è `forward_origin` –¥–ª—è –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π). –¢–∞–±–ª–∏—Ü—ã –¥–æ–ª–≥–æ–≤ –∏–∑ –æ—Ç—á—ë—Ç–æ–≤ `/bill` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç ¬´X –¥–æ–ª–∂–µ–Ω Y: —Å—É–º–º–∞¬ª –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
3. –°–æ–±–∏—Ä–∞–µ—Ç `help()` –≤—Å–µ—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤ ‚Üí –∫–∞—Ç–∞–ª–æ–≥ –∫–æ–º–∞–Ω–¥
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Yandex GPT: –∫–∞—Ç–∞–ª–æ–≥ + –∫–æ–Ω—Ç–µ–∫—Å—Ç + –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. LLM –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–Ω—É –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥ (–ø–æ –æ–¥–Ω–æ–π –Ω–∞ —Å—Ç—Ä–æ–∫—É)
6. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã —Å –∫–Ω–æ–ø–∫–∞–º–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
7. –ü–æ –Ω–∞–∂–∞—Ç–∏—é ‚úÖ ‚Äî –ø–∞—Ç—á–∏—Ç `message.text` –∏ `entities`, –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
8. –ü–æ –Ω–∞–∂–∞—Ç–∏—é ‚ùå ‚Äî –æ—Ç–º–µ–Ω—è–µ—Ç
9. –ï—Å–ª–∏ LLM –Ω–µ –Ω–∞—à—ë–ª –ø–æ–¥—Ö–æ–¥—è—â—É—é –∫–æ–º–∞–Ω–¥—É ‚Äî –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–º

### –•—Ä–∞–Ω–µ–Ω–∏–µ pending-–∫–æ–º–∞–Ω–¥

–û–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã —Ö—Ä–∞–Ω—è—Ç—Å—è in-memory –≤ `_pending: dict[str, PendingExecution]`. –ú–∞–∫—Å–∏–º—É–º 100 –∑–∞–ø–∏—Å–µ–π, —Å—Ç–∞—Ä—ã–µ –≤—ã—Ç–µ—Å–Ω—è—é—Ç—Å—è. –ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç —Ä–µ—Å—Ç–∞—Ä—Ç –±–æ—Ç–∞. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- –°–µ—Å—Å–∏–æ–Ω–Ω—ã–µ —Ö–µ–Ω–¥–ª–µ—Ä—ã (broadcast, reward add) –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä
- –ö–æ–Ω—Ç–µ–∫—Å—Ç `reply_to_message` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è `/translate`, `/remind` —Å –ø–µ—Ä–µ—Å—ã–ª–∫–æ–π)
- Reply/forward-—Ç—Ä–∏–≥–≥–µ—Ä –±–µ–∑ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å –≤–∏–¥–µ–æ (–≤–∫–ª—é—á–∞—è –≤–∏–¥–µ–æ, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫–∞–∫ —Ñ–∞–π–ª-–¥–æ–∫—É–º–µ–Ω—Ç)
- Admin-only –∫–æ–º–∞–Ω–¥—ã —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- Rate limit: 15 req/min –æ–±—â–∏–π, 5 req/30s –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥

–ù–∏–∫–∞–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ –Ω—É–∂–Ω–æ ‚Äî —Ä–æ—É—Ç–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç `help()` –≤—Å–µ—Ö —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤.

## Rate limiting

–í—Å–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã —á–µ—Ä–µ–∑ `check_limit` –∏–∑ `steward/helpers/limiter.py`. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –±—Ä–æ—Å–∞–µ—Ç—Å—è `BucketFullException`, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤".

## –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –º–µ–¥–∏–∞

- –î–ª—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ (—á–µ—Ä–µ–∑ `DownloadHandler`) –¥–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ `–¢–µ–∫—Å—Ç`, –∫–æ—Ç–æ—Ä–∞—è –∑–∞–ø—É—Å–∫–∞–µ—Ç STT –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É –≤ –ø–æ–¥–ø–∏—Å—å.
- –î–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (—á–µ—Ä–µ–∑ `VoiceVideoHandler`) –±–æ—Ç –Ω–µ –¥–µ–ª–∞–µ—Ç –Ω–∏—á–µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ `–°–æ–∑–¥–∞—Ç—å –≤–∏–¥–µ–æ` –∏ `–°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É`.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ `–ù–∏—á–µ–≥–æ`: —É–¥–∞–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏, –µ—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –Ω—É–∂–µ–Ω.
- –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –Ω–∞–∂–∞–ª–∏, –∏—Å—á–µ–∑–∞–µ—Ç, –∞ –æ—Å—Ç–∞–≤—à–∞—è—Å—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–≤–∏–¥–µ–æ –∏–ª–∏ —Ç–µ–∫—Å—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏).
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–±–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ElevenLabs (`model_id="scribe_v1"`) –∏ –∫–ª—é—á `EVELEN_LABS_STT`.
- –ï—Å–ª–∏ –∫–ª—é—á –Ω–µ –∑–∞–¥–∞–Ω –∏–ª–∏ STT –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
- –ù–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≥–æ–ª–æ—Å–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤—É–µ—Ç –ª–∏–º–∏—Ç: 10 –º–∏–Ω—É—Ç –∞—É–¥–∏–æ –≤ —Å—É—Ç–∫–∏ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
- –ü—Ä–∏ diarization –≤ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–µ –ø–µ—Ä–≤—ã–π —Å–ø–∏–∫–µ—Ä –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ: —Å–Ω–∞—á–∞–ª–∞ `stand_name` (–∏ `@username` –≤ —Å–∫–æ–±–∫–∞—Ö), –µ—Å–ª–∏ —Å—Ç–µ–Ω–¥–∞ –Ω–µ—Ç ‚Äî `@username`.
- –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ø–∏–∫–µ—Ä–æ–≤ (–µ—Å–ª–∏ –æ–Ω–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã) –æ—Å—Ç–∞—é—Ç—Å—è –ø—Å–µ–≤–¥–æ–Ω–∏–º—ã.
