# Dev конфигурация
# Использование: docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d

services:
  bot:
    entrypoint: ["/bin/sh", "/scripts/wait-for-tunnel.sh"]
    command: ["python", "main.py", "--prod"]
    volumes:
      - ./scripts:/scripts:ro
      - tunnel-info:/shared
    depends_on:
      - localhost-run
    develop:
      watch:
        - action: sync+restart
          path: ./steward
          target: /app/steward
        - action: sync+restart
          path: ./main.py
          target: /app/main.py

  web:
    develop:
      watch:
        - action: sync
          path: ./web/src
          target: /app/src
        - action: rebuild
          path: ./web/package.json

  localhost-run:
    build:
      context: ./scripts
      dockerfile: Dockerfile.localhost-run
    environment:
      - LOCAL_PORT=5173
    volumes:
      - tunnel-info:/shared
    network_mode: "service:web"
    depends_on:
      - web
    restart: unless-stopped

volumes:
  tunnel-info:
